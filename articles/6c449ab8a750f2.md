---
title: "ãªã‚“ã¨ãªãä½¿ã‚ãªã„Gradle"
emoji: "ğŸ“‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["java", "kotlin", "gradle"]
published: false
---

# ã¯ã˜ã‚ã«

æœ€è¿‘ã‚¹ãƒ‘ã‚¤ã‚¹ã‚«ãƒ¬ãƒ¼ã‚’é£Ÿã¹ã‚‹ã®ã¯ã‚‚ã¡ã‚ã‚“ã€ä½œã‚‹ã®ã«ã‚‚ãƒãƒã£ã¦ã„ã‚‹å°æ—([@mako-makok](https://twitter.com/mako_makok))ã§ã™ã€‚
è¿‘æ‰€ã®ãŠæ°—ã«å…¥ã‚Šã®ãŠåº—ã®é–‰åº—ãŒæ±ºã¾ã£ã¦ã—ã¾ã„ã€æ‚²ã—ã¿ã«æš®ã‚Œã¦ã„ã¾ã™ãŒé ‘å¼µã£ã¦ã‚¢ãƒ‰ã‚«ãƒ¬ã®è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã¯æ ªå¼ä¼šç¤¾ãƒ­ã‚°ãƒ©ã‚¹Productãƒãƒ¼ãƒ ã®2022å¹´12/18(æ—¥)ã®è¨˜äº‹ã§ã™ã€‚
[æ ªå¼ä¼šç¤¾ãƒ­ã‚°ãƒ©ã‚¹ Product ãƒãƒ¼ãƒ  ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ | Advent Calendar 2022 - Qiita](https://qiita.com/advent-calendar/2022/loglass)

ãªãœä»Šæ›´Gradleã‹ã¨ã„ã†ã¨ã€æœ€è¿‘ç¤¾å†…ã§æ§‹ç¯‰ã—ã¦ã„ã‚‹`Sheetlin`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚Šã¾ã™ã€‚
ãƒ‹ãƒƒãƒãªè©±ã«ãªã‚Šã¾ã™ãŒã€[Sheetlin ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆã«é–¢ã™ã‚‹è©±](https://speakerdeck.com/makomakok/use-of-kotlin-dot-jvm-and-interface-design-for-kotlin-oss-that-can-also-be-used-in-java)ã‚’Kotlin Fest Reject Conference 2022ã§ã—ã¦ããŸã®ã§ã€ã‚ˆã‚ã—ã‘ã‚Œã°ã“ã¡ã‚‰ã‚‚ã”è¦§ãã ã•ã„ã€‚

ãã‚“ãª`Sheetlin`ã§ã™ãŒã€ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã¯Gradleã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
ç§ã‚‚é›°å›²æ°—ã§Gradleã‚’æ›¸ã„ã¦ã„ãŸã®ã§ã™ãŒã€ä»Šå›ãƒ“ãƒ«ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ã‚’1ã‹ã‚‰æ›¸ãã«ã‚ãŸã£ã¦åŸºç¤ã¨ãƒ¢ãƒ€ãƒ³ãªãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã¤ã„ã¦ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚
ã“ã®è¨˜äº‹ã‚’èª­ã¾ã‚Œã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã¯å°‘ã—ã§ã‚‚Gradleã«èˆˆå‘³ã‚’æŒã£ã¦ã„ã‚‹ã€æ¥­å‹™ã§ä½¿ã£ã¦ã„ã‚‹æ–¹ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

- æ™®æ®µã¯é›°å›²æ°—ã§Gradleä½¿ã£ã¦ã„ã‚‹ã‘ã©ã„ã¤ã‹ã¯ã—ã£ã‹ã‚Šç†è§£ã—ãŸã„ã¨æ€ã£ã¦ã„ã‚‹æ–¹
- Gradleã£ã¦è‰²ã€…æ›¸ãæ–¹ã‚ã‚‹ã‘ã©æœ€è¿‘ã®æ›¸ãæ–¹ãŒã‚ã‹ã‚‰ãªã„æ–¹

ã¨ã„ã†æ–¹å‘ã‘ã«ã€åŸºç¤çš„ãªéƒ¨åˆ†ã‹ã‚‰ã€æœ€è¿‘ã®Gradleäº‹æƒ…ã‚’ã‹ã„ã¤ã¾ã‚“ã§ã”ç´¹ä»‹ã—ã¾ã™ã€‚

# Gradle ã¨ã¯

Gradleã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ãƒ“ãƒ«ãƒ‰è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
Gradleã¯JVMä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€Java, Kotlin, Scalaãªã©ã€JVMç³»ã®è¨€èªã§æ›¸ã‹ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã—ã°ã—ã°åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚
JVMä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ã ã‘ã§ã€å®Ÿã¯TypeScriptã‚„Goã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ãƒ“ãƒ«ãƒ‰ã§ããŸã‚Šã—ã¾ã™ã€‚

å®Ÿæ…‹ã¯ä¾å­˜é–¢ä¿‚ã«åŸºã¥ãã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã§ã‚ã‚Šã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚„ãƒ“ãƒ«ãƒ‰ã€å®Ÿè¡Œãªã©ã¯å€‹ã€…ã®ã‚¿ã‚¹ã‚¯ã§ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚
ä¾‹ãˆã°Spring Bootãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§`bootRun`ã‚’å®Ÿè¡Œã™ã‚‹ã¨è‡ªå‹•çš„ã«ã‚¢ãƒ—ãƒªãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚„ãƒ“ãƒ«ãƒ‰ã¨ã„ã£ãŸã‚¿ã‚¹ã‚¯ãŒ`bootRun`ã«ç´ä»˜ã„ã¦ãŠã‚Šã€ä¾å­˜é–¢ä¿‚ãŒæ•´ç†ã•ã‚ŒãŸä¸Šã§é †åºã©ãŠã‚Šå®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚

ã‚ˆã‚Šè©³ã—ã„è©±ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«[Build Lifecycle](https://docs.gradle.org/current/userguide/build_lifecycle.html#build_lifecycle)ã®é …ã«ã¾ã¨ã¾ã£ã¦ã„ã¾ã™ã€‚

é›£ã—ãæ„Ÿã˜ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å®Ÿéš›ã¯è‡ªåˆ†ã§ã‚´ãƒªã‚´ãƒªæ›¸ãã‚·ãƒ¼ãƒ³ã¯å°‘ãªã„ã§ã™ã€‚
åŸºæœ¬çš„ã«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ã‚„å¾Œç¶šã§ç´¹ä»‹ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å…¥ã‚Œã¦å°‘ã—ã®è¨­å®šã‚’ã™ã‚‹ã ã‘ã§ç°¡å˜ã«æ§˜ã€…ãªã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã‚Œã‚‹éå¸¸ã«ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

# Gradle ã®æ¦‚å¿µ

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

Gradleã®ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã®ã“ã¨ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨å‘¼ã³ã¾ã™ã€‚

[Spring Initializr](https://start.spring.io/) ã§Gradleã‚’é¸æŠã—ã¦DLã™ã‚‹ã¨ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ«ãƒ¼ãƒˆã« `build.gradle` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª = 1ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã„ã†å½¢ã«ãªã‚Šã¾ã™ã€‚
`build.gradle` ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šã‚„ã‚¿ã‚¹ã‚¯ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¼‰ã—ã¦ã„ãã¾ã™ã€‚
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒã‚¹ãƒˆã•ã›ãŸã‚Š(ãƒã‚¹ãƒˆã•ã›ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚µãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨å‘¼ã¶)ã€ä¾å­˜é–¢ä¿‚ã‚’è‡ªä¿¡ã§å®šç¾©ã—ã¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã™ã‚‹(ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–)ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

Gradleã§ã¯ã€DSLã¨ã—ã¦Groovyã‚‚ã—ãã¯Kotlinã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚

## ã‚¿ã‚¹ã‚¯

ã‚¿ã‚¹ã‚¯ã¯

- ãƒ“ãƒ«ãƒ‰
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- ãƒ‡ãƒ—ãƒ­ã‚¤

ã¨ã„ã£ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã«ãŠã‘ã‚‹ä½•ã‹ã—ã‚‰ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã‚‚ã®ã§ã™ã€‚
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚‚æ§˜ã€…ãªã‚¿ã‚¹ã‚¯ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ãŠã‚Šã€ä¸€èˆ¬çš„ãªæœ€ä½é™ã®ãƒ“ãƒ«ãƒ‰ã®ãƒ‹ãƒ¼ã‚ºã‚’æº€ãŸã™ã‚ˆã†ãªã‚‚ã®ã¯ã ã„ãŸã„ã‚ã‚Šã¾ã™ã€‚
ã‚ˆã‚Šé«˜åº¦ãªã“ã¨ã‚’å®Ÿç¾ã™ã‚‹å ´åˆã¯ã€å¾Œç¶šã§èª¬æ˜ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã‹ã€DSLã§è‡ªä½œã®ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã—ã¾ã™ã€‚

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã¨ä¾¿åˆ©ãªã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã§ããŸã‚Šã€ãƒ“ãƒ«ãƒ‰è‡ªå‹•åŒ–ã‚’è¶…ãˆãŸã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

ä¸€éƒ¨ã®ä¾‹ã§ã™ãŒã€å¼Šç¤¾ã§ã¯Gradleã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚

- Ktlintã‚’ä½¿ã£ã¦ktãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ã‹ã‘ã‚‹
- SonarQubeã§é™çš„è§£æã‚’è¡Œãªã†
- ã‚µãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¯ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆãƒ»ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ã²ã¨ã¾ã¨ã‚ã«ã—ã¦é–²è¦§ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ“ãƒ«ãƒ‰ã®ç¯„ç–‡å¤–ã®ã‚¿ã‚¹ã‚¯ã‚’è¡Œãªã†ã“ã¨ãŒã§ãã¾ã™ã€‚
ã¾ãŸã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯è‡ªä½œã§ãã¾ã™ã€‚
ä¾‹ãˆã°ã‚µãƒ—ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆA, B, CãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚
Aã¨Bã ã‘ã§è‡ªä½œã—ãŸã“ã®ã‚¿ã‚¹ã‚¯ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ãŸã„ã‘ã©Cã§ã¯åˆ©ç”¨ã•ã›ãŸããªã„ã€ã¨ã„ã†çŠ¶æ³ã§ã€ã‚¿ã‚¹ã‚¯ã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åŒ–ã—ã¦ã‚µãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§èª­ã¿è¾¼ã‚€è¨­å®šã‚’ã™ã‚‹ã“ã¨ã§è§£æ±ºã§ãã¾ã™ã€‚

## ã¾ã¨ã‚

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã§ã‚¿ã‚¹ã‚¯ã‚„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šã‚’è¡Œãªãˆã‚‹
- è¨­å®šã¯åŸºæœ¬çš„ã« `build.gradle` ã«æ›¸ã„ã¦ã„ã
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯è‡ªä½œã§ãã‚‹

# Gradle ã®ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

Gradleã®æ¦‚å¿µã¨ã—ã¦ã¯ä»¥ä¸ŠãŒåŸºæœ¬ã¨ãªã‚Šã¾ã™ã€‚
ã‚ã¨ã¯ã©ã‚Œã ã‘æ›¸ãæ–¹ã‚’çŸ¥ã£ã¦ã„ã‚‹ã‹ã€ãƒ¡ã‚½ãƒƒãƒ‰ã‚’çŸ¥ã£ã¦ã„ã‚‹ã‹ã®å‹è² ã§ã™ã€‚
ãƒ¡ã‚½ãƒƒãƒ‰ã¯ç„¡æ•°ã«ã‚ã‚‹ã®ã§ã€å…¨éƒ¨ã‚’ç´¹ä»‹ã§ãã¾ã›ã‚“ãŒã€ã„ãã¤ã‹ãƒ”ãƒƒã‚¯ã—ã¦ã”ç´¹ä»‹ã—ã¾ã™ã€‚

## Kotlin DSL ã‚’ä½¿ã†

Gradleã®è¨­å®šã‚’è¨˜è¼‰ã™ã‚‹ã¨ãã¯Groovyã‚’ä½¿ã†ã“ã¨ãŒä¸»æµã§ã—ãŸãŒã€ã“ã“æ•°å¹´ã§å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»IDEã‚µãƒãƒ¼ãƒˆã®æ‹¡å……ã«ã‚ˆã‚ŠKotlinã§æ›¸ãã“ã¨ãŒå¢—ãˆã¦ãã¦ã„ã¾ã™ã€‚
KotlinãŒå°å…¥ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã€ãã®ã¾ã¾Kotlinã§æ›¸ã‘ã¦ã—ã¾ã†ã®ã§å°å…¥ã—ãªã„æ‰‹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
å°å…¥ã•ã‚Œã¦ã„ãªã„å ´åˆã§ã‚‚ã€Kotlin DSLã¯build.gradleã®æ‹¡å¼µå­ã« `.kts` ã‚’ã¤ã‘ã‚‹ã ã‘ã§æ›¸ãå§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Kotlinã¯Javaãƒ©ã‚¤ã‚¯ã«æ›¸ã‘ã¤ã¤ã€Javaã‚ˆã‚Šã‚‚æ¯”è¼ƒçš„ç°¡æ½”ãªè¨˜è¿°ã‚’ã§ãã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚
Javaã®ã‚¹ã‚­ãƒ«ã‚»ãƒƒãƒˆãŒã‚ã‚Œã°ãã“ã¾ã§å›°ã‚‰ãšæ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€ã„ãã¤ã‹æ‹¡å¼µé–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ãŠã‚Šã€Gradleã®è¨­å®šè‡ªä½“ã‚’ç°¡æ½”ã«è¡Œãªã†ã‚ˆã†ãªAPIã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚
æœ¬æ ¼çš„ã«ç§»è¡Œã—ã‚ˆã†ã¨ãªã£ãŸå ´åˆã¯ã€Androidã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§Kotlin DSLã¸ã®[ç§»è¡Œã‚¬ã‚¤ãƒ‰](https://developer.android.com/studio/build/migrate-to-kts?hl=ja)ãŒã‚ã‚Šã¾ã™ã€‚

## jvmToolchain ã®ä½¿ç”¨

Gradle 6.7ã§è¿½åŠ ã•ã‚ŒãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚
[https://docs.gradle.org/current/userguide/toolchains.html](https://docs.gradle.org/current/userguide/toolchains.html)

ã©ã®Javaã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å‹•ã‹ãã†ã€ã¨ãªã£ãŸã¨ãã€ã‚‚ã¨ã‚‚ã¨ `jvmTarget`ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«8ã‚„11ã®ã‚ˆã†ãªæ•°å€¤ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§Javaã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ã¾ã—ãŸã€‚
ã“ã‚Œã ã‘ã§ã‚‚ä¾¿åˆ©ãªã®ã§ã™ãŒã€`jvmToolchain` ã¯æ›´ã«ä¾¿åˆ©ã§ã™ã€‚
ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ™‚ã«æŒ‡å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®JavaãŒå…¥ã£ã¦ã„ãªã„å ´åˆã€è‡ªå‹•çš„ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã¦ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Javaã‚’åˆ©ç”¨ã—ã¦ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã„ã¾ã™ã€‚

```kotlin
kotlin {
    jvmToolchain {
        (this).languageVersion.set(JavaLanguageVersion.of(11))
    }
}
```

`jvmTarget` ã‚‚å€‹åˆ¥ã«æŒ‡å®šã§ãã¾ã™ãŒã€ç‰¹ã«ä½•ã‚‚æ›¸ã‹ãªã„å ´åˆ`jvmToolchain` ã§æŒ‡å®šã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ`jvmTarget` ã«ãªã‚Šã¾ã™ã€‚

## éæ¨å¥¨ã¨ãªã£ã¦ã„ã‚‹æ›¸ãæ–¹

Gradleã¯é€²åŒ–ãŒæ—©ãã€éæ¨å¥¨ã¨ãªã£ã¦ã„ã‚‹æ›¸ãæ–¹ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚
å¤ã„æƒ…å ±ã¨æ–°ã—ã„æƒ…å ±ã§æ›¸ãæ–¹ãŒç•°ãªã£ã¦æ··ä¹±ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ãã†ã„ã£ãŸé•å’Œæ„Ÿã‚’æ„Ÿã˜ãŸéš›ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§æ¢ã™ã¨è‰¯ã„ã§ã™ã€‚
ä»Šå›ã¯å€‹äººçš„ã«æ··ä¹±ã—ã¦ã—ã¾ã£ãŸäº‹ä¾‹ã‚’2ã¤ç´¹ä»‹ã—ã¾ã™ã€‚

### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å°å…¥ã«ã¯ apply plugin ã‚’åˆ©ç”¨ã—ãªã„

`apply plugin` ã¯ãƒ¬ã‚¬ã‚·ãƒ¼ã§ã™ã€‚
[https://docs.gradle.org/current/userguide/plugins.html#sec:old_plugin_application](https://docs.gradle.org/current/userguide/plugins.html#sec:old_plugin_application)

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®åˆ©ç”¨ã¯plugin DSLã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```kotlin
plugins {
    id("com.jfrog.bintray") version "1.8.5"
}
```

### ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆã§ subprojects{}, allprojects{} ã‚’ä½¿ã‚ãªã„

Gradleã§ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚ã†ã€ã¨ãªã£ãŸã¨ãæ›¸ãæ–¹ãŒè‰²ã€…ã‚ã‚‹ã®ã§ã™ãŒã€ãã®1ã¤ã« `subprojects{ â€¦ }` , `allprojects{ â€¦ }` ã¨ã„ã†æ›¸ãæ–¹ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ãªã«ã‹ã¨ã„ã†ã¨ã€ãƒ–ãƒ­ãƒƒã‚¯å†…ã«è¨­å®šã‚’æ›¸ã„ã¦ã„ãã¨ãã‚ŒãŒå­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚é©ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã«ãªã£ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚

```
root-project
â”œâ”€â”€ build.gragle
â”œâ”€â”€ project-a
â”‚Â Â  â”œâ”€â”€ build.gradle
â”œâ”€â”€ project-b
 Â Â  â”œâ”€â”€ build.gradle
```

root-projectã«`subprojects{ â€¦ }` , `allprojects{ â€¦ }` ã§è¨­å®šã‚’æ›¸ã„ã¦ã„ãã¨ã€project-aã¨project-bã«ã‚‚ãã®è¨­å®šãŒé©ç”¨ã•ã‚Œã‚‹ã¨ã„ã†ç¶™æ‰¿ã®ã‚ˆã†ãªæŒ™å‹•ã‚’ã—ã¾ã™ã€‚

ã“ã®æ›¸ãæ–¹ã¯[å…¬å¼ã§ã¯éæ¨å¥¨](https://docs.gradle.org/current/userguide/sharing_build_logic_between_subprojects.html)ã¨ãªã£ã¦ã„ã¾ã™ã€‚

- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¤‡é›‘åŒ–ã—ã¦ãã‚‹ã¨åˆ†å²ãŒç™ºç”Ÿã—ã¦è¤‡é›‘ã«ãªã‚‹
- ä¾å­˜é–¢ä¿‚ã®æ•´ç†ãŒé›£ã—ããªã£ã¦ã„ãã€ä¸è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã‚“ã ã‚Šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç®¡ç†ãŒé›£ã—ããªã‚‹
  - ç„¡é§„ãªã‚‚ã®ã‚’èª­ã¿è¾¼ã‚“ã å ´åˆã€ãƒ“ãƒ«ãƒ‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯ä¸‹ãŒã‚‹

æ§‹æ–‡çš„ã«ã¯ã‹ãªã‚Šèª­ã¿ã‚„ã™ã„ã®ã§ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆãŒè¤‡é›‘ã«ãªã‚‰ãªã„ã¨ã„ã†ã®ãŒç¢ºå®šã—ã¦ã„ã‚Œã°å°å…¥ã—ã¦ã‚‚ã•ã»ã©å•é¡Œãªã„ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚
é€†ã«ã€ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¢ãƒãƒªã‚¹æ§‹æˆã®ã‚ˆã†ãªã‚‚ã®ã‚’ã‚„ã‚Šå§‹ã‚ã‚‹ã¨ãƒ“ãƒ«ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ã‚„ä¾å­˜ãŒé€”ç«¯ã«è¤‡é›‘åŒ–ã™ã‚‹ã®ã§ã€‚

ã§ã¯ã©ã†ã™ã‚‹ã®ãŒè‰¯ã„ã‹ã¨ã„ã†ã¨ã€

- å…±é€šã®è¨­å®šã¯ `buildSrc` ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ãã“ã«è¨˜è¼‰ã™ã‚‹
- å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ãã®è¨­å®šã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§æ˜ç¤ºçš„ã«èª­ã¿è¾¼ã‚€

ã¨ã„ã†æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

> We recommend putting source code and tests for the convention plugins in the special buildSrc directory in the root directory of the project. For more information about buildSrc, consult Using buildSrc to organize build logic.

å…¬å¼ã§å¤§è¦æ¨¡ãªãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã‚ã‚‹ã®ã§ã€èˆˆå‘³ã‚ã‚‹æ–¹ã¯è¦—ã„ã¦ã¿ã¦ãã ã•ã„ã€‚

[https://docs.gradle.org/7.5.1/userguide/structuring_software_products.html](https://docs.gradle.org/7.5.1/userguide/structuring_software_products.html)

# ãƒãƒ³ã‚ºã‚ªãƒ³

ã“ã“ã¾ã§Gradleã®æ§˜ã€…ãªæ©Ÿèƒ½ã‚’ç´¹ä»‹ã—ã¾ã—ãŸãŒã€è«–ã‚ˆã‚Šã‚³ãƒ¼ãƒ‰ã¨ã„ã†ã“ã¨ã§å®Ÿéš›ã«Gradleã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚
ã“ã“ã§ã¯ã€Spring Initializrã§Groovyãƒ™ãƒ¼ã‚¹ã®build.gradleã‚’ã€Kotlin DSLã§æ›¸ãç›´ã—ã¦ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã—ã¦ã„ãã¾ã™ã€‚

## Spring Initinalizr ã§ Spring Boot ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é››å½¢ã‚’ DL

[æ§‹æˆ](https://start.spring.io/#!type=gradle-project&language=java&platformVersion=2.7.6&packaging=jar&jvmVersion=17&groupId=com.example&artifactId=demo&name=demo&description=Demo%20project%20for%20Spring%20Boot&packageName=com.example.demo&dependencies=web,web-services)

- Gradle - Groovy
- Language: Java
- Java 17
- Dependencies
  - Spring Web
  - Spring Web Service

## 1. API ã‚’ä½œæˆã™ã‚‹

APIã®å†…å®¹ã¯æœ¬è³ªã§ã¯ç„¡ã„ã®ã§é©å½“ã§ã™ãŒã€apiã¨domainã¯å¾Œã§ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã™ã‚‹ã®ã§åˆ†ã‘ã¦ãŠãã¾ã™ã€‚(åŸ·ç­†æ—¥ã¯é ‘å¼µã£ãŸã”è¤’ç¾ã«ã™ãã‚„ãã‚’é£Ÿã¹ã¾ã—ãŸ)
ä»Šå›domainã«é–¢ã—ã¦ã¯ã€ä¾å­˜é–¢ä¿‚ã‚’ä½œã‚ŠãŸã‹ã£ãŸã®ã§ã€ Project <- ToDoã¨ã„ã†ä¾å­˜ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚

ã¾ãšã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’2ã¤ãšã¤ä½œæˆã—ã¾ã™ã€‚

```bash
mkdir -p src/main/java/com/example/demo/{domain,api}
touch src/main/java/com/example/demo/domain/{ToDo.java,Project.java}
touch src/main/java/com/example/demo/api/{ToDoController.java,ProjectController.java}
```

```java:ToDo.java
package com.example.demo.domain;

public record ToDo(String id, String description) {

}
```

```java:Project.java
package com.example.demo.domain.project;

import com.example.demo.todo.ToDo;

import java.util.List;

public record Project(String id, String name, List<ToDo> toDos) {
}
```

```java:ToDoController.java
package com.example.demo.api;

import com.example.demo.domain.ToDo;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
@RequestMapping("/api/todos")
class ToDoController {

    @GetMapping
    public List<ToDo> getTodos() {
        return List.of(
            new ToDo("1", "ã™ãã‚„ãã‚’é£Ÿã¹ã‚‹"),
            new ToDo("2", "æ´—å‰¤ã‚’è²·ã†")
        );
    }
}
```

```java:ProjectController.java
package com.example.demo.api;

import com.example.demo.domain.Project;
import com.example.demo.domain.ToDo;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
@RequestMapping("api/projects")
class ProjectController {

    @GetMapping
    public List<Project> list() {
        return List.of(
            new Project(
                "1",
                "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆA",
                List.of(
                    new ToDo("1", "ã™ãã‚„ãã‚’é£Ÿã¹ã‚‹")
                )
            ),
            new Project(
                "2",
                "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆB",
                List.of(
                    new ToDo("2", "æ´—å‰¤ã‚’è²·ã†")
                )
            )
        );
    }
}
```

ä¸€æ—¦èµ·å‹•ã—ã¦ã¿ã¦ã€APIãŒå©ã‘ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
gradleã¯JavaãŒå®Ÿè¡Œã§ãã‚‹ç’°å¢ƒã§ã‚ã‚Œã°å®Ÿè¡Œã§ãã¾ã™ã€‚

```bash
# Linux, Mac
./gradlew bootRun

# Windous
gradle.bat bootRun
```

èµ·å‹•ã—ãŸã‚‰APIã‚’å©ã„ã¦çµæœãŒè¿”ã£ã¦ãã‚Œã°æˆåŠŸã§ã™ã€‚

```bash
curl http://localhost:8080/api/todos
[{"id":"1","description":"ã™ãã‚„ãã‚’é£Ÿã¹ã‚‹"},{"id":"2","description":"æ´—å‰¤ã‚’è²·ã†"}]
```

## 2. build.gradle ã‚’ Kotlin DSL ã§æ›¸ãæ›ãˆã‚‹

æ¬¡ã¯Kotlin DSLã§æ—¢å­˜ã®build.gradleã‚’æ›¸ãæ›ãˆã¦ã„ãã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ãªbuild.gradleãŒã‚ã‚Šã¾ã™ã€‚

```groovy
// pluginã®èª­ã¿è¾¼ã¿ã€‚apply pluginã§ã¯ãªã plugin DSLã‚’ä½¿ã£ã¦æ›¸ã‹ã‚Œã¦ã„ã‚‹
plugins {
	id 'java'
	id 'org.springframework.boot' version '2.7.6'
	id 'io.spring.dependency-management' version '1.0.15.RELEASE'
}

// ãƒ“ãƒ«ãƒ‰ã®æƒ…å ±ã€‚sourceCompatibilityã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã«åˆ©ç”¨ã™ã‚‹Javaã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨˜è¼‰ã™ã‚‹
group = 'com.example'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '17'

// ãƒªãƒã‚¸ãƒˆãƒªã®è¨­å®šã€‚å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã©ã“ã‹ã‚‰ãã‚Œã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã‚‹ã‹ã®è¨­å®šãŒå¿…è¦
// ä»Šå›ã¯mavanãŒç®¡ç†ã—ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹
repositories {
	mavenCentral()
}

// å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã€‚dependenciesãƒ–ãƒ­ãƒƒã‚¯å†…ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªåã‚’è¨˜è¼‰ã™ã‚‹
// implementationã¯å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã€testImplementationã¯testé…ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§åˆ©ç”¨ã§ãã‚‹
dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-web-services'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

// ã‚‚ã¨ã‚‚ã¨å­˜åœ¨ã™ã‚‹ã€Œtestã€ã¨ã„ã†ã‚¿ã‚¹ã‚¯ã‚’æ‹¡å¼µã—ã¦ã„ã‚‹
// org.springframework.boot:spring-boot-starter-testã‚’å…¥ã‚Œã‚‹ã¨ã€useJUnitPlatform()ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹
// useJUnitPlatform()ã¯jUnit5ã§å®Ÿè¡Œã™ã‚‹ã‚ˆã¨ã„ã†æ„å‘³
tasks.named('test') {
	useJUnitPlatform()
}
```

ã¡ãªã¿ã«ã€1ã®é …ã§ä½•æ°—ãªã `./gradlew bootRun` ãŒã§ãã¾ã—ãŸãŒã€ `org.springframework.boot` ã¨ã„ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ `bootRun` ã¨ã„ã†ã‚¿ã‚¹ã‚¯ãŒè¿½åŠ ã•ã‚ŒSpring Bootã®èµ·å‹•ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

æœ¬é¡Œã‹ã‚‰ãšã‚Œã¾ã—ãŸãŒã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Kotlinã§æ›¸ãæ›ãˆã¦ã„ãã¾ã™ã€‚

ã¾ãšã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `build.gradle` â†’ `build.gradle.kts` ã«ãƒªãƒãƒ¼ãƒ ã—ã¾ã™ã€‚
ã“ã®çŠ¶æ…‹ã§ `./gradlew bootRun` ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã§è½ã¡ã¾ã™ã€‚

`build.gradle.kts` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚

- ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚’ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã«å¤‰æ›
- id, implementation, testImplementationã¯ã‹ã£ã“ã§æ‹¬ã‚‹ã‚ˆã†ã«ã™ã‚‹
- `sourceCompatibility` ã®å‰ã« `java.` ã‚’ã¤ã‘ã‚‹
- `task.named('test')` ã‚’ `tasks.withType<Test>` ã«å¤‰æ›´ã™ã‚‹

```groovy
plugins {
	id("java")
	id("org.springframework.boot") version "2.7.ï¼–"
	id("io.spring.dependency-management") version "1.0.15.RELEASE"
}

group = "com.example"
version = "0.0.1-SNAPSHOT"
java.sourceCompatibility = JavaVersion.VERSION_17

repositories {
	mavenCentral()
}

dependencies {
	implementation("org.springframework.boot:spring-boot-starter-web")
	implementation("org.springframework.boot:spring-boot-starter-web-services")
	testImplementation("org.springframework.boot:spring-boot-starter-test")
}

tasks.withType<Test> {
	useJUnitPlatform()
}
```

Kotlinã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ã‹ã‚‰ã™ã‚‹ã¨ã€`plugins`ã‚„`id`ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã€ `sourceCompatibility` ã¦javaã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãªã‚“ã ã€ã¨ã„ã†ã“ã¨ãŒåˆ†ã‹ã£ã¦ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

å¤§ããªå¤‰æ›´ç‚¹ã¨ã—ã¦ã¯`tasks.named('test')` ãŒ `withType` ã«å¤‰ãˆã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯æ‹¡å¼µé–¢æ•°ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ãŠã‚Šã€ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§ã‚¿ã‚¹ã‚¯ã‚’çµã‚Šè¾¼ã‚“ã§æ‹¡å¼µã—ã¦ã„ãã“ã¨ãŒå¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚
[https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:locating_tasks](https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:locating_tasks)

:::details Kotlinã®å›ºæœ‰ã®æ–‡æ³•ãŒã‚ã‹ã‚‰ãªã„ã¨ã„ã†æ–¹ã¯ã“ã¡ã‚‰

- ãƒ–ãƒ©ã‚±ãƒƒãƒˆã§å›²ã¾ã‚Œã¦ã„ã‚‹éƒ¨åˆ†ãªã«
  - é«˜éšé–¢æ•°ã®å‘¼ã³å‡ºã—æ™‚ã€functionã®éƒ¨åˆ†ã¯ãƒ–ãƒ©ã‚±ãƒƒãƒˆã§å›²ã£ã¦æ›¸ãã“ã¨ãŒã§ãã¾ã™
  - [https://dogwood008.github.io/kotlin-web-site-ja/docs/reference/lambdas.html](https://dogwood008.github.io/kotlin-web-site-ja/docs/reference/lambdas.html)
- `withType` ã€Groovyã§æ›¸ã“ã†ã¨ã™ã‚‹ã¨ç„¡ã„ã‚“ã ã‘ã©

  - Kotlinã«ã¯æ‹¡å¼µé–¢æ•°ã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™
  - ä»¥ä¸‹ã®ã‚ˆã†ã«æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã«å¯¾ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¶³ã™ã‚ˆã†ãªæ›¸ãæ–¹ãŒã§ãã¾ã™ã€‚

        ```kotlin
        fun String.hello() {
          return "hello"
        }

        print("hoge".hello()) // hello
        ```

:::

## ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–

ã¾ãšã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãã®ä¸­ã«ãã‚Œãã‚Œ `build.gradle.kts` ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

```bash
mkdir -p api/src/main/java/com/example/demo/controller
mkdir -p domain/{todo,project}/src/main/java/com/example/demo
mkdir -p buildSrc/src/main/kotlin

touch api/build.gradle.kts
touch domain/{todo,project}/build.gradle.kts
touch buildSrc/build.gradle.kts
```

æ¬¡ã«ã€1ã§ä½œæˆã—ãŸã‚¯ãƒ©ã‚¹ãŸã¡ã‚’ç§»å‹•ã•ã›ã¦ã„ãã¾ã™ã€‚

```bash
mv src/main/java/com/example/demo/api/* api/src/main/java/com/example/demo/controller/
mv src/main/java/com/example/demo/domain/todo/ToDo.java domain/todo/src/main/java/com/example/demo/
mv src/main/java/com/example/demo/domain/project/ToDo.java domain/project/src/main/java/com/example/demo/
```

### setting.gradle ã®ä¿®æ­£

ãƒ«ãƒ¼ãƒˆã« `setting.gradle` ãŒã‚ã‚‹ã®ã§ã€ktsåŒ–ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¼‰ã—ã¾ã™ã€‚

```bash
rootProject.name = "gradle-sample"
include(":domain:todo", ":domain:project", "api")
```

ä½œæˆã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ `include` ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åç§°ã‚’Stringã®é…åˆ—ã§æ¸¡ã—ã¾ã™ã€‚
ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒéšå±¤åŒ–ã•ã‚Œã¦ã„ã‚‹å ´åˆã€`:` ã§åŒºåˆ‡ã£ã¦è¨˜è¼‰ã—ã¾ã™ã€‚

### buildSrc ã«ã¤ã„ã¦

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ç‰¹åˆ¥ãªã‚‚ã®ã¨ãªã£ã¦ã„ã¾ã™ã€‚
Gradleã¯å®Ÿè¡Œæ™‚ã« `buildSrc` ã‚’æ¢ã—ã¦ã€ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯è‡ªå‹•çš„ã«ãƒ“ãƒ«ãƒ‰ã•ã‚Œã€build scriptã®ã‚¯ãƒ©ã‚¹ãƒ‘ã‚¹ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚

è¦ã¯ã“ã“ã«ç½®ã„ãŸã‚‚ã®ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åŒ–ã•ã‚Œã¾ã™ã€‚
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãªã®ã§ã€ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰èª­ã¿è¾¼ã‚€ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ä»Šå›ã¯Javaãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä½¿ã„ãã†ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã€Spring Bootã‚’åˆ©ç”¨ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®äºŒç¨®é¡ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚
ã¾ãšã¯ `buildSrc` é…ä¸‹ã«ã‚ã‚‹ `build.gradle.kts` ã‚’ä¿®æ­£ã—ã¦ã„ãã¾ã™ã€‚
ä»Šå›ä½œã£ã¦ã„ããƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‚Kotlinã®ã‚³ãƒ¼ãƒ‰ãªã®ã§ã€ãã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ãƒ»å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹è¨­å®šã‚’æ›¸ãã¾ã™ã€‚

```kotlin:buildSrc/build.gradle.kts
// ktsã‚’ä½¿ã£ã¦è¨­å®šã‚’æ›¸ã„ã¦ã„ãã®ã§ã€kotlin-dslãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹
plugins {
    `kotlin-dsl`
}

repositories {
    mavenCentral()
}

// Spring Bootã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã“ã“ã§æŒ‡å®šã™ã‚‹
dependencies {
    implementation("org.springframework.boot:spring-boot-gradle-plugin:2.7.6")
}
```

Spring Bootã®ä¾å­˜ã‚’æŠœã„ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚
ã¾ãŸå¿…é ˆã§ã¯ç„¡ã„ã§ã™ãŒã€ãƒ„ãƒ¼ãƒ«ãƒã‚§ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```kotlin:buildSrc/src/main/java/java-common-conventions.kts
plugins {
    java
}

group = "com.example"
version = "1.0-SNAPSHOT"

repositories {
    mavenCentral()
}

dependencies {
    testImplementation("org.junit.jupiter:junit-jupiter")
}

tasks.withType<Test> {
    useJUnitPlatform()
}

// Javaã®è¨­å®šã‚’toolchainã«å¯„ã›ã‚‹
java {
    toolchain {
        languageVersion.set(JavaLanguageVersion.of(17))
    }
}
```

ç¶šã„ã¦ã€Spring Bootã®ä¾å­˜ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã—ã¾ã™ã€‚

```kotlin:buildSrc/src/main/java/spring-conventions.kts
plugins {
    // ä½œæˆã—ãŸãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯é€šå¸¸ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨åŒæ§˜ã«id()ã§èª­ã¿è¾¼ã‚ã‚‹
    id("java-common-conventions")
    id("org.springframework.boot")
    id("io.spring.dependency-management")
}

repositories {
    mavenCentral()
}

dependencies {
    implementation("org.springframework.boot:spring-boot-starter-web")
    implementation("org.springframework.boot:spring-boot-starter-web-services")
    testImplementation("org.springframework.boot:spring-boot-starter-test")
}
```

ä»¥ä¸Šã§buildSrcã®è¨­å®šã¯çµ‚ã‚ã‚Šã§ã™ã€‚

## ä½œæˆã—ãŸãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ domain, api ã§èª­ã¿è¾¼ã‚€

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã§ããŸã®ã§ã€æ¬¡ã¯åˆ©ç”¨ã™ã‚‹å´ã®è¨­å®šã‚’ã—ã¾ã™ã€‚

apiã¨ãã‚Œãã‚Œã®domainã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ‡ã‚Šã€ç´°ã‹ãä¾å­˜ã‚’å®šç¾©ã—ã¦ã‚ã’ã‚‹ã“ã¨ã§ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¢ãƒãƒªã‚¹æ§‹æˆã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

```kotlin:domain/todo/build.gradle.kts
plugins {
    id("java-common-conventions")
}
```

```kotlin:domain/project/build.gradle.kts
plugins {
    id("java-common-conventions")
}

// ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯project()ã§èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹
dependencies {
    implementation(project(":domain:todo"))
}
```

```kotlin:api/build.gradle.kts
plugins {
    id("spring-conventions")
}

dependencies {
    implementation(project(":domain:project"))
    implementation(project(":domain:todo"))
}
```

ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã§ã™ã€‚

- domainã¯Spring Bootã¸ã®ä¾å­˜ã¯ã„ã‚‰ãªã„ã®ã§javaã®å…±é€šè¨­å®šã ã‘ã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§èª­ã¿è¾¼ã‚€
- `Todo`ã¨ã„ã†domainã¯Projectã®ã“ã¨ã‚’çŸ¥ã‚‰ãªãã¦ã‚‚è‰¯ã„ã®ã§ç¾çŠ¶ã©ã“ã«ã‚‚ä¾å­˜ã—ã¦ã„ãªã„
- é€†ã«`Project`ã¨ã„ã†domainã¯`ToDo`ã«ä¾å­˜ã—ã¦ã„ã‚‹ã®ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦`Todo`ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
- apiã¯ã²ã¨ã¾ã¨ã‚ã«ã—ã¦ã„ã‚‹ã®ã§åŸºæœ¬çš„ã«å…¨éƒ¨èª­ã¿è¾¼ã¿

ä»Šå›ã¯ç°¡ç•¥åŒ–ã®ãŸã‚ã«apiã‹ã‚‰domainã‚’ç›´æ¥èª­ã¿è¾¼ã‚€æ§‹æˆã«ã—ã¦ã„ã¾ã™ãŒã€api â† application â† domain â† infrastructureã®ã‚ˆã†ã«ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒãƒƒã‚¯ã«ä¾å­˜ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã‚‚ã‚‚ã¡ã‚ã‚“å¯èƒ½ã§ã™ã€‚

## å‹•ã‹ã—ã¦ã¿ã‚‹

ãƒ“ãƒ«ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ã®æ§‹ç¯‰ã¯ä»¥ä¸Šã¨ãªã‚Šã¾ã™ã€‚
åŒæ§˜ã«å‹•ã‹ã—ã¦ã¿ã¦ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚Œã°æˆåŠŸã§ã™ã€‚

```kotlin
./gradlew bootRun

curl http://localhost:8080/api/todos
curl http://localhost:8080/api/projects
```

æœ€çµ‚çš„ã«ã§ããŸã‚‚ã®ã¯ã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚
https://github.com/mako-makok/spring-boot-multi-module-sample/tree/main

# çµ‚ã‚ã‚Šã«

Gradleã®ç´¹ä»‹ã¨å®Ÿéš›ã«ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã‚’è¡Œã„ã¾ã—ãŸã€‚
Gradleã¯ä»–ã«ã‚‚ãŸãã•ã‚“ã®æ©Ÿèƒ½ãŒã‚ã‚Šã€ãƒ“ãƒ«ãƒ‰ã‚„CI/CDã‚’é«˜é€ŸåŒ–ãƒ»åŠ¹ç‡åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ç´¹ä»‹ã—ãŸã‚‚ã®ä»¥å¤–ã«ã‚‚æ§˜ã€…ãªãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒã‚ã‚Šã¾ã™ã®ã§ã€ã“ã®è¨˜äº‹ã‚’æœŸã«Gradleã«èˆˆå‘³ã‚’æŒã£ã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚
Gradleã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã¨ã¦ã‚‚å……å®Ÿã—ã¦ã„ã‚‹ã®ã§ã€å›°ã£ãŸã¨ãã¯æ˜¯éå‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

# å‚è€ƒãƒªãƒ³ã‚¯

- Build Lifecycle
  - https://docs.gradle.org/current/userguide/build_lifecycle.html#build_lifecycle
- jvmToolChainã«
  - [https://docs.gradle.org/current/userguide/toolchains.html](https://docs.gradle.org/current/userguide/toolchains.html)
- ãƒ¬ã‚¬ã‚·ãƒ¼ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³
  - [https://docs.gradle.org/current/userguide/plugins.html#sec:old_plugin_application](https://docs.gradle.org/current/userguide/plugins.html#sec:old_plugin_application)
- å¤§è¦æ¨¡ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹ç¯‰
  - [https://docs.gradle.org/7.5.1/userguide/structuring_software_products.html](https://docs.gradle.org/7.5.1/userguide/structuring_software_products.html)
- ã‚¿ã‚¹ã‚¯å®šç¾©
  - [https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:locating_tasks](https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:locating_tasks)
