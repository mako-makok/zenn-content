---
title: "Cypress hands on"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["JavaScript", "TypeScript", "Cypress", "E2E"]
published: true
---

Cypress ã‚’è§¦ã‚‹æ©Ÿä¼šãŒã‚ã£ãŸã®ã§ã€å‚™å¿˜éŒ²çš„ã«ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚

## Cypress ã¨ã¯

- ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ JavaScript è£½ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚‚ã®ã¯ã™ã¹ã¦ãƒ†ã‚¹ãƒˆã§ãã‚‹ã¨è¬³ã£ã¦ã„ã‚‹
- å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆ
  - E2E Test
    - åŸºæœ¬çš„ã«ã“ã¡ã‚‰ãŒãƒ¡ã‚¤ãƒ³
  - Unit Test
    - `mocha` + `chai` ãƒ™ãƒ¼ã‚¹
      - ã¤ã¾ã‚Š `Jest` ã‚’åˆ¥ã«å…¥ã‚Œã¦ã‚‹ã¨ã‚ã¡ã‚ƒãã¡ã‚ƒè¡çªã™ã‚‹
  - API Test

## Cypress ã®ã„ã„ã¨ã“ã‚

- ãƒ–ãƒ©ã‚¦ã‚¶ã‚’åˆ©ç”¨ã—ãŸãƒ†ã‚¹ãƒˆã‚’è¡Œã„ãŸã„ã¨ãã«`npm install cypress`ã™ã‚‹ã¨å…¨éƒ¨å…¥ã£ã¦ãã‚‹
  - ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹ãªã©ã€è¤‡é›‘ãªã¨ã“ã‚ã¯éš è”½ã—ã¦ãã‚Œã¦ã„ã‚‹ãŸã‚ã™ãã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã‘ã‚‹
- E2E ãƒ†ã‚¹ãƒˆ
  - å¤±æ•—ã—ãŸã¨ãã«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’è‡ªå‹•ã§æ’®ã‚‹
  - E2E ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã®æ§˜å­ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦å‹•ç”»ã«ã—ã¦ãã‚Œã‚‹
  - è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤
    - ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†ã¾ã§å¾…æ©Ÿã™ã‚‹ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ãªãã¦è‰¯ã„
  - [ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ](https://docs.cypress.io/guides/guides/launching-browsers#Browsers)
    - IE ã¯æœªå¯¾å¿œ
  - GUI å®Œå‚™
    - DOM æ“ä½œã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–ã‚ŠãªãŒã‚‰å±¥æ­´ã‚’æ®‹ã—ã¦ãã‚Œã‚‹
      - ãƒ‡ãƒãƒƒã‚°ãŒéå¸¸ã«ã—ã‚„ã™ã„
    - ãƒ†ã‚¹ãƒˆçµæœã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è¡¨ç¤º
  - ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹å¯¾å¿œ

## ä»–ãƒ„ãƒ¼ãƒ«ã¨ã®æ¯”è¼ƒ

E2E ãƒ†ã‚¹ãƒˆã‚’ã‚„ã‚ŠãŸã„ã€ã¨ãªã£ãŸã¨ãã«ã‚ˆãä¸ŠãŒã‚‹ã®ãŒä»¥ä¸‹ã§ã™ã€‚

- Selenium
- Puppeteer
- Test Cafe

### Cypress VS Selenium & Puppeteer

ãã‚‚ãã‚‚ã€Selenium ã¨ Puppeteer ã¯ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã§ã¯ãªãã€ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œè‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚  
Selenium ã ã¨ Web Driver ã®ç®¡ç†ãŒå¿…è¦ã ã£ãŸã‚Šã€ä¸¡æ–¹ã¨ã‚‚ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è‡ªå‰ã§ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Cypress ã«ã¯ E2E ãƒ†ã‚¹ãƒˆé–‹ç™ºã‚’ä¾¿åˆ©ã«ã—ã¦ãã‚Œã‚‹å¤šãã®æ©Ÿèƒ½ãŒã‚ã‚‹ãŸã‚ã€E2E ãƒ†ã‚¹ãƒˆã¨ã„ã†è¦³ç‚¹ã§ã¯ Cypress ã«è»é…ãŒä¸ŠãŒã‚‹ã§ã—ã‚‡ã†ã€‚

### Cypress VS Test Cafe

Test Cafe ã¯éå¸¸ã«é«˜æ©Ÿèƒ½ã§ã€Cypress ã¨æ¯”ã¹ã¦ã‚‚éœè‰²ã¯ãªã„ã€‚ã¨ã„ã†ã‹ã‚€ã—ã‚ Cypress ã‚ˆã‚Šé«˜æ©Ÿèƒ½ã§ã™ã€‚ä¸‹è¨˜ã®æ©Ÿèƒ½ã¯ã‚‚ã¡ã‚ã‚“ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

- è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤
- ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
  - ç‹¬è‡ªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
- GUI
- TypeScript

- Pros
  - IE å¯¾å¿œ â—‹
  - ãƒãƒ«ãƒã‚¦ã‚£ãƒ³ãƒ‰ã‚¦/ã‚¿ãƒ–æ“ä½œãŒã§ãã‚‹
  - ä¸¦åˆ—å®Ÿè¡ŒãŒã§ãã‚‹
- Cons
  - Node ã§å‹•ã„ã¦ã„ã‚‹ã®ã§ DOM ã¨ã‹ã¯å…¨éƒ¨ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã•ã‚Œã¦ã„ã‚‹
  - ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãŒ Cypress ã‚ˆã‚Šå°ã•ã„

Cypress ã§å®Ÿç¾ã§ããªã„è¦ä»¶ãŒã‚ã‚‹å ´åˆã¯ TestCafeã€ãã†ã§ãªã„å ´åˆã¯ Cypress ã§è‰¯ã„ã¨è¨€ã†ã®ãŒç§ã®çµè«–ã§ã™ã€‚  
å®Œå…¨ã«ä¸»è¦³ã ãŒã€Cypress ã®ã»ã†ãŒå…¬å¼ã®ã‚µãƒãƒ¼ãƒˆãŒæ‰‹åšãã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ•´å‚™ã‚‚ã•ã‚Œã¦ã„ã‚‹ã€‚GUI ã® UX(=ãƒ‡ãƒãƒƒã‚¬ãƒ“ãƒªãƒ†ã‚£)ã‚‚è‰¯ã„ã§ã™ã€‚  
Cypress ã¯ IE ã‚’å®Œå…¨ã«åˆ‡ã‚Šæ¨ã¦ã¦ã„ã‚‹ã®ã§ã€ã“ã“ãŒå¤§ããªãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## Cypress ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

1. `npm install cypress`
2. `npx cypress open`
3. GUI ãŒé–‹ãã®ã§ã€ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å§‹ã¾ã‚‹

ã“ã®çŠ¶æ…‹ã§ã¯ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

```shell
> tree -I node_modules

â”œâ”€â”€ cypress
â”‚   â”œâ”€â”€ fixtures
â”‚   â”‚   â””â”€â”€ example.json
â”‚   â”œâ”€â”€ integration
â”‚   â”‚   â”œâ”€â”€ 1-getting-started
â”‚   â”‚   â”‚   â””â”€â”€ todo.spec.js
â”‚   â”‚   â””â”€â”€ 2-advanced-examples
â”‚   â”‚       â”œâ”€â”€ actions.spec.js
â”‚   â”‚       â”œâ”€â”€ aliasing.spec.js
â”‚   â”‚       â”œâ”€â”€ assertions.spec.js
â”‚   â”‚       â”œâ”€â”€ connectors.spec.js
â”‚   â”‚       â”œâ”€â”€ cookies.spec.js
â”‚   â”‚       â”œâ”€â”€ cypress_api.spec.js
â”‚   â”‚       â”œâ”€â”€ files.spec.js
â”‚   â”‚       â”œâ”€â”€ local_storage.spec.js
â”‚   â”‚       â”œâ”€â”€ location.spec.js
â”‚   â”‚       â”œâ”€â”€ misc.spec.js
â”‚   â”‚       â”œâ”€â”€ navigation.spec.js
â”‚   â”‚       â”œâ”€â”€ network_requests.spec.js
â”‚   â”‚       â”œâ”€â”€ querying.spec.js
â”‚   â”‚       â”œâ”€â”€ spies_stubs_clocks.spec.js
â”‚   â”‚       â”œâ”€â”€ traversal.spec.js
â”‚   â”‚       â”œâ”€â”€ utilities.spec.js
â”‚   â”‚       â”œâ”€â”€ viewport.spec.js
â”‚   â”‚       â”œâ”€â”€ waiting.spec.js
â”‚   â”‚       â””â”€â”€ window.spec.js
â”‚   â”œâ”€â”€ plugins
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ support
â”‚       â”œâ”€â”€ commands.js
â”‚       â””â”€â”€ index.js
â”œâ”€â”€ cypress.json
â”œâ”€â”€ package-lock.json
â””â”€â”€ package.json
```

åŸºæœ¬ã“ã®æ§‹æˆã‹ã‚‰å´©ã™å¿…è¦ã¯ãªã„ã§ã™ã€‚ãã‚Œãã‚Œå€‹åˆ¥ã«èª¬æ˜ã—ã¾ã™ã€‚

### cypress.json

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã‚ã‹ã‚Šã‚„ã™ã„ã®ã§èª¬æ˜ã¯çœãã¾ã™ã€‚  
https://docs.cypress.io/guides/references/configuration

### fixtures

json ã‚„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã€å›ºå®šãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’é…ç½®ã—ã¾ã™ã€‚  
ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®å½¢å¼ãªã©ã‚‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§é¸æŠã§ãã¾ã™ã€‚
è©³ã—ãã¯ä»¥ä¸‹ã§ã™ã€‚
https://docs.cypress.io/api/commands/fixture

ä»¥ä¸‹ã¯å…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«ã€‚json ã‚’èª­ã¿è¾¼ã‚€ã¨ãã¯ import ã™ã‚‹ã‹ã€`cy.fixture`ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ç›´æ¥ã‚ãŸã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã€‚

```js
import user from "../fixtures/user.json";
it("loads the same object", () => {
  cy.fixture("user").then((userFixture) => {
    expect(user, "the same data").to.deep.equal(userFixture);
  });
});
```

### integration

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®é…ç½®å ´æ‰€ã§ã™ã€‚
ãƒ†ã‚¹ãƒˆã¯ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã®å½¢ã§æ›¸ã‘ã‚‹ã®ã§ã€ã¨ã¦ã‚‚ç›´æ„Ÿçš„ã§ã™ã€‚

```js
describe('app layout and responsiveness', () => {
    it('click test', () => {
        cy.visit('https://foo.example.com')
        // fooã¨ã„ã†contentã‚’æŒã¤DOMã‚’å–å¾— & å­˜åœ¨ã—ãªã‘ã‚Œã°ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼. ã‚»ãƒ¬ã‚¯ã‚¿ã‚‚æŒ‡å®šå¯èƒ½.
        cy.contains('foo')
            .click()
            .contains('success')
    }

    it('type test', () => {
        cy.visit('https://bar.example.com')
        const mailForm = cy.contains('mail address')
        mailForm
            .get('input').type('foo@example.com')
        mailForm
            .contains('submit').click()
    })
}
```

`contains`ãŒã¨ã¦ã‚‚å”åŠ›ã§ã€ã‚»ãƒ¬ã‚¯ã‚¿ã‚’æ›¸ãæ©Ÿä¼šãŒåŠ‡çš„ã«æ¸›ã‚Šã¾ã™ã€‚  
ä»–ã«ã‚‚ä¾¿åˆ©ãª API ãŒãŸãã•ã‚“ã‚ã‚‹ã®ã§ã€ãœã²ã”ç¢ºèªãã ã•ã„ã€‚  
https://docs.cypress.io/api/table-of-contents

### support

Cypress ã§ã¯ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã‚’å®šç¾©ã§ãã€ãã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚„è¨­å®šã‚’ã“ã®`support`é…ä¸‹ã«é…ç½®ã—ã¾ã™ã€‚  
E2E ãƒ†ã‚¹ãƒˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦ã‚ˆãæŒ™ã’ã‚‰ã‚Œã‚‹ã®ãŒãƒšãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚ãŒã€ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ Cypress ã§ã¯æ¨å¥¨ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«ã“ã¡ã‚‰ã®ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã“ã¨ã‚’æ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚  
ãªãœãƒšãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ¨å¥¨ã•ã‚Œã¦ã„ãªã„ã®ã‹ã¯ä»¥ä¸‹ã‚’å¾¡è¦§ãã ã•ã„ã€‚  
https://www.cypress.io/blog/2019/01/03/stop-using-page-objects-and-start-using-app-actions/

ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã«ã¯èª¬æ˜ã™ã‚‹ã‚ˆã‚Šè¦‹ãŸã»ã†ãŒæ—©ã„ã¨æ€ã„ã§ã™ã€‚è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
> cat cypress/support/commands.js

// ***********************************************
// This example commands.js shows you how to
// create various custom commands and overwrite
// existing commands.
//
// For more comprehensive examples of custom
// commands please read more here:
// https://on.cypress.io/custom-commands
// ***********************************************
//
//
// -- This is a parent command --
// Cypress.Commands.add('login', (email, password) => { ... })
//
//
// -- This is a child command --
// Cypress.Commands.add('drag', { prevSubject: 'element'}, (subject, options) => { ... })
//
//
// -- This is a dual command --
// Cypress.Commands.add('dismiss', { prevSubject: 'optional'}, (subject, options) => { ... })
//
//
// -- This will overwrite an existing command --
// Cypress.Commands.overwrite('visit', (originalFn, url, options) => { ... }
```

```sh
> cat cypress/support/index.js

// ***********************************************************
// This example support/index.js is processed and
// loaded automatically before your test files.
//
// This is a great place to put global configuration and
// behavior that modifies Cypress.
//
// You can change the location of this file or turn off
// automatically serving support files with the
// 'supportFile' configuration option.
//
// You can read more here:
// https://on.cypress.io/configuration
// ***********************************************************

// Import commands.js using ES2015 syntax:
import './commands'

// Alternatively you can use CommonJS syntax:
// require('./commands')
```

E2E ãƒ†ã‚¹ãƒˆã‚’è¤‡æ•°æ›¸ã„ã¦ã¿ã‚‹ã¨ã€åŒã˜ã‚ˆã†ãªæ“ä½œãŒå‡ºã¦ãã‚‹ã§ã—ã‚‡ã†ã€‚ä¾‹ãˆã°ã€Œã‚¢ãƒ—ãƒªã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã€ã€ŒA ã‚’ B ã« D&D ã™ã‚‹ã€ãªã©ã§ã™ã€‚  
Cypress ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æä¾›ã•ã‚Œã¦ã„ã‚‹ API ã§ã¯ã§ããªã„ã‘ã©ã€å®šå‹åŒ–ã•ã‚ŒãŸæ“ä½œã¯ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã«ã—ã¦ã—ã¾ã†ã¨è‰¯ã„ã§ã™ã€‚  
æ¬¡ã®ä¾‹ã¯ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã‚’ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã«è¿½åŠ ã™ã‚‹ä¾‹ã§ã™ã€‚

```js
// support/commands.js
Cypress.Commands.add('login', (email, password) => {
  cy.visit()
  cy.contains('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹')
    .get('input')
    .type(email)
  cy.contains('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰')
    .get('input')
    .type(password))
  cy.contains('ãƒ­ã‚°ã‚¤ãƒ³')
    .click()
})

// support/index.js
import './commands'

// test code
cy.login('foo@example.com', 'foo')
```

### plugins

ç¾çŠ¶ã€Cypress ã§ã¯ã§ããªã„ã“ã¨ã‚„ã€ç”Ÿã® API ã ã‘ã§å®Ÿç¾ã™ã‚‹ã®ã¯å¤§å¤‰ãªã“ã¨ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚  
ãã†ã„ã£ãŸã‚‚ã®ã¯æä¾›ã•ã‚Œã¦ã„ã‚‹ plugin ã§è§£æ±ºã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚(ã‚‚ã¡ã‚ã‚“è‡ªåˆ†ã§ plugin ã‚’æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™)  
plugin ã‚’åˆ©ç”¨ã—ãŸã„å ´åˆã¯ã€`plugins/index.js`ã«è¨˜è¼‰ã™ã‚‹ã“ã¨ã§è¿½åŠ ã§ãã¾ã™ã€‚  
ä¾‹ãˆã°ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆãªã©ãŒã„ã„ä¾‹ã§ã™ã€‚

1. plugin ã‚’ install

```sh
npm install --save-dev cypress-image-snapshot
```

2. `plugins/index.js`ã§è¨­å®šã™ã‚‹

```js
const {
  addMatchImageSnapshotPlugin,
} = require("cypress-image-snapshot/plugin");

module.exports = (on, config) => {
  addMatchImageSnapshotPlugin(on, config);
};
```

3. `support`é…ä¸‹ã«ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã

```js
import { addMatchImageSnapshotCommand } from "cypress-image-snapshot/command";
addMatchImageSnapshotCommand();
```

4. ãƒ†ã‚¹ãƒˆã‚’æ›¸ã(refs: https://github.com/jaredpalmer/cypress-image-snapshot#syntax)

Cypress ã¯ä»–ã«ã‚‚æ§˜ã€…ãª plugin ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
